# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ –≤–∫–ª–∞–¥–∫–µ "–ü–æ—Ä—Ç—Ñ–µ–ª—å" –¥–ª—è ETF –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –æ–±—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞ "ETF 1CCN", "ETF 1HLF" –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–æ–Ω–¥–æ–≤ –∏ –∫–æ–º–ø–∞–Ω–∏–π.

## –ü—Ä–∏—á–∏–Ω–∞
–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ø–æ–ª—É—á–∞–ª–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–∑ API Tinkoff, –∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞ –æ–±—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ —Ç–∏–∫–µ—Ä–∞.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π (`InstrumentNameService.java`)

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```java
@Service
public class InstrumentNameService {
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ FIGI
    public String getInstrumentName(String figi, String instrumentType)
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ä–∞ –ø–æ FIGI
    public String getTicker(String figi, String instrumentType)
    
    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    private final Map<String, String> instrumentNameCache = new ConcurrentHashMap<>();
    private final Map<String, String> tickerCache = new ConcurrentHashMap<>();
}
```

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:
- **–ê–∫—Ü–∏–∏** (`share`) - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `getShareByFigiSync()`
- **–û–±–ª–∏–≥–∞—Ü–∏–∏** (`bond`) - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `getBondByFigiSync()`
- **ETF** (`etf`) - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `getEtfByFigiSync()`
- **–í–∞–ª—é—Ç—ã** (`currency`) - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `getCurrencyByFigiSync()`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω `PortfolioDto.java`

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è DTO:
```java
public static PortfolioDto fromWithNames(ru.tinkoff.piapi.core.models.Portfolio portfolio, 
                                       InstrumentNameService nameService)
```

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π:
```java
public static PositionDto fromWithNames(ru.tinkoff.piapi.core.models.Position position, 
                                      InstrumentNameService nameService)
```

#### –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π:
```java
// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∏ —Ç–∏–∫–µ—Ä–æ–≤
String ticker = nameService.getTicker(position.getFigi(), position.getInstrumentType());
String name = nameService.getInstrumentName(position.getFigi(), position.getInstrumentType());

dto.setTicker(ticker != null ? ticker : "N/A");
dto.setName(name != null ? name : getInstrumentTypeDisplayName(position.getInstrumentType()));
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `PortfolioService.java`

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥:
```java
public PortfolioDto getPortfolioWithNames(String accountId, InstrumentNameService nameService)
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω `PortfolioController.java`

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π endpoint:
```java
@GetMapping("/with-names")
public ResponseEntity<?> getPortfolioWithNames(@RequestParam("accountId") String accountId)
```

**URL:** `GET /api/portfolio/with-names?accountId=123456`

### 5. –†–µ–∑–µ—Ä–≤–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### –°–ª–æ–≤–∞—Ä—å –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö FIGI:
```java
// –ê–∫—Ü–∏–∏
"TCS00A106YF0" -> "–¢–∏–Ω—å–∫–æ—Ñ—Ñ –ë–∞–Ω–∫"
"BBG004730N88" -> "–°–±–µ—Ä–±–∞–Ω–∫ –†–æ—Å—Å–∏–∏"
"BBG0047315Y7" -> "–ì–∞–∑–ø—Ä–æ–º"
"BBG004731354" -> "–õ—É–∫–æ–π–ª"
"BBG004731489" -> "–ù–æ–≤–∞—Ç—ç–∫"
"BBG004731032" -> "–†–æ—Å–Ω–µ—Ñ—Ç—å"
"BBG0047315D0" -> "–ú–∞–≥–Ω–∏—Ç"
"BBG0047312Z9" -> "–Ø–Ω–¥–µ–∫—Å"
"BBG0047319J7" -> "–í–∫—É—Å–í–∏–ª–ª"
"BBG0047319J8" -> "Ozon"

// ETF —Ç–∏–∫–µ—Ä—ã
"1CCN" -> "–°–±–µ—Ä–±–∞–Ω–∫ - –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π"
"1HLF" -> "–°–±–µ—Ä–±–∞–Ω–∫ - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"
"14M8" -> "–°–±–µ—Ä–±–∞–Ω–∫ - –ê–∫—Ç–∏–≤–Ω—ã–π"
"19HZ" -> "–°–±–µ—Ä–±–∞–Ω–∫ - –ó–æ–ª–æ—Ç–æ"
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- **–¢–∏–∫–µ—Ä:** 1CCN
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** ETF 1CCN
- **–¢–∏–∫–µ—Ä:** 1HLF
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** ETF 1HLF

### ‚úÖ **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- **–¢–∏–∫–µ—Ä:** 1CCN
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** –°–±–µ—Ä–±–∞–Ω–∫ - –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
- **–¢–∏–∫–µ—Ä:** 1HLF
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** –°–±–µ—Ä–±–∞–Ω–∫ - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
- **–¢–∏–∫–µ—Ä:** TCS
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ë–∞–Ω–∫

## API Endpoints

### 1. –û–±—ã—á–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å (—Å—Ç–∞—Ä—ã–π endpoint):
```
GET /api/portfolio?accountId=123456
```

### 2. –ü–æ—Ä—Ç—Ñ–µ–ª—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ (–Ω–æ–≤—ã–π endpoint):
```
GET /api/portfolio/with-names?accountId=123456
```

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- **–ö—ç—à –Ω–∞–∑–≤–∞–Ω–∏–π:** `instrumentNameCache`
- **–ö—ç—à —Ç–∏–∫–µ—Ä–æ–≤:** `tickerCache`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –Ω–∞–∑–≤–∞–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- Graceful degradation - –µ—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ endpoint:
```bash
curl "http://localhost:8081/api/portfolio/with-names?accountId=YOUR_ACCOUNT_ID"
```

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
- –°—Ç–∞—Ä—ã–π endpoint: `GET /api/portfolio`
- –ù–æ–≤—ã–π endpoint: `GET /api/portfolio/with-names`

### 3. –û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- ETF –ø–æ–ª—É—á–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–º–µ—Å—Ç–æ "ETF [TICKER]"
- –ê–∫—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–π
- –û–±–ª–∏–≥–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —ç–º–∏—Ç–µ–Ω—Ç–æ–≤
- –í–∞–ª—é—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
- **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –°–æ–∑–¥–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏


