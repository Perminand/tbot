# üöÄ –£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞ - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. **–°–æ–∑–¥–∞–Ω SmartAnalysisService**
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω TradingBotScheduler**
- ‚úÖ –£–º–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (30 —Å–µ–∫)
- ‚úÖ –£–º–Ω—ã–π –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (2 –º–∏–Ω)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SmartAnalysisService

### 3. **–°–æ–∑–¥–∞–Ω SmartAnalysisController**
- ‚úÖ API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- ‚úÖ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. **SmartAnalysisService.java**
```
src/main/java/ru/perminov/service/SmartAnalysisService.java
```
**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –†–æ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞
- –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 2. **SmartAnalysisController.java**
```
src/main/java/ru/perminov/controller/SmartAnalysisController.java
```
**API Endpoints:**
- `GET /api/smart-analysis/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/smart-analysis/fallback-status` - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º
- `GET /api/smart-analysis/quick-instruments` - –±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
- `GET /api/smart-analysis/full-instruments` - –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- `POST /api/smart-analysis/update-priority` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

### 3. **SMART_ANALYSIS_STRATEGY.md**
```
SMART_ANALYSIS_STRATEGY.md
```
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 4. **SMART_ANALYSIS_IMPLEMENTATION.md**
```
SMART_ANALYSIS_IMPLEMENTATION.md
```
**–û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. **TradingBotScheduler.java**
```java
// –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
@Scheduled(fixedRate = 30000)
public void smartQuickMonitoring()

@Scheduled(fixedRate = 120000) 
public void smartFullMonitoring()

private void updateInstrumentPriority(String figi, MarketAnalysisService.TrendAnalysis trend)
```

### 2. **application.yml**
```yaml
# –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
dynamic-instruments:
  cache:
    max-shares: 100     # –ë—ã–ª–æ 30
    max-bonds: 50       # –ë—ã–ª–æ 15
    max-etfs: 30        # –ë—ã–ª–æ 10

smart-analysis:
  quick-monitoring:
    priority-instruments: 5
    rotation-instruments: 5
  full-monitoring:
    priority-instruments: 15
    rotation-instruments: 15
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**
```java
// –í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏
List<ShareDto> existingPositions = getExistingPositions(accountId);

// –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏
List<ShareDto> priorityInstruments = getPriorityInstruments(5);

// –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —Ä–æ—Ç–∏—Ä—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
List<ShareDto> rotationInstruments = getRotationInstruments(5);
```

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**
```java
switch (trend.getTrend()) {
    case BULLISH:    priority = 80;  // –í–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
    case BEARISH:    priority = 60;  // –ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
    case SIDEWAYS:   priority = 40;  // –ë–æ–∫–æ–≤–æ–π —Ç—Ä–µ–Ω–¥
    case UNKNOWN:    priority = 20;  // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç—Ä–µ–Ω–¥
}
```

### 3. **–†–æ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞**
```java
// –†–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã —Ä–æ—Ç–∞—Ü–∏–∏
private final int ROTATION_BATCH_SIZE = 20;

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
rotationIndex = (rotationIndex + ROTATION_BATCH_SIZE) % totalInstruments;
```

### 4. **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º**
```java
// 20 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º —Å–ø–∏—Å–∫–µ
private List<ShareDto> getFallbackInstruments() {
    // 10 –∞–∫—Ü–∏–π, 5 –æ–±–ª–∏–≥–∞—Ü–∏–π, 5 ETF, 2 –≤–∞–ª—é—Ç—ã
}
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è 180 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:

| –†–µ–∂–∏–º | –ß–∞—Å—Ç–æ—Ç–∞ | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ | –í—Ä–µ–º—è | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|-------|---------|--------------|-------|----------|
| –ë—ã—Å—Ç—Ä—ã–π | 30 —Å–µ–∫ | 10-15 | 30 —Å–µ–∫ | 100% –∑–∞ –¥–µ–Ω—å |
| –ü–æ–ª–Ω—ã–π | 2 –º–∏–Ω | 30-40 | 2 –º–∏–Ω | 100% –∑–∞ –¥–µ–Ω—å |
| –†–æ—Ç–∞—Ü–∏—è | 1 –¥–µ–Ω—å | 20 | 24 —á–∞—Å–∞ | 100% –∑–∞ 9 –¥–Ω–µ–π |

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑:** 10-15 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ **–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:** 30-40 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ 2 –º–∏–Ω—É—Ç—ã
- ‚úÖ **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** –í—Å–µ 180 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ 1 –¥–µ–Ω—å
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è

## üõ°Ô∏è –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è:
- ‚ùå –û—à–∏–±–∫–∏ API Tinkoff
- ‚ùå –ü—É—Å—Ç–æ–π –∫—ç—à –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚ùå –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API

### –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ (20 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤):
- üîµ **10 –∞–∫—Ü–∏–π** (TCS, SBER, GAZP, LKOH, NVTK, ROSN, MGNT, YNDX, VKUS, OZON)
- üü¢ **3 –≥–æ—Å. –æ–±–ª–∏–≥–∞—Ü–∏–∏** (–û–§–ó-26238, –û–§–ó-26239, –û–§–ó-26240)
- üü° **2 –∫–æ—Ä–ø. –æ–±–ª–∏–≥–∞—Ü–∏–∏** (–°–±–µ—Ä–±–∞–Ω–∫-001–†, –ì–∞–∑–ø—Ä–æ–º-001–†)
- üü£ **5 ETF** (FXRL, FXUS, FXDE, FXCN, FXGD)
- üí∞ **2 –≤–∞–ª—é—Ç—ã** (USD000UTSTOM, EUR_RUB__TOM)

## üìà API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:
```bash
GET /api/smart-analysis/stats
```

### –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞:
```bash
GET /api/smart-analysis/fallback-status
```

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```bash
GET /api/smart-analysis/quick-instruments?accountId=123456
GET /api/smart-analysis/full-instruments?accountId=123456
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
```bash
POST /api/smart-analysis/update-priority?figi=TCS00A106YF0&priority=85
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:**
- üöÄ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
- üìä **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è** –≤–∞–∂–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- üîÑ **–°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è** –¥–ª—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º

### ‚úÖ **–ë–æ—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —É–º–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:**
- **–ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥** - –±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞–∂–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã** - –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –≤ —Ñ–æ–∫—É—Å–µ
- **–†–æ—Ç–∞—Ü–∏—è** - —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º** - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

### 2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

### 3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
- –£–ª—É—á—à–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Ä–æ—Ç–∞—Ü–∏–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

–£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ



