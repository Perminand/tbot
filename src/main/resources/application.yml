spring:
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/tbot_db}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:password}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    enabled: true
    drop-first: false

# Tinkoff Invest API Configuration
tinkoff:
  api:
    # Токен для песочницы (тестовый)
    sandbox-token: ${TINKOFF_SANDBOX_TOKEN:t.CRkcaE_K19MSklxNKVqJ2rcohwl5CGpwN6Hxp58mdase_kEotm5eXbt2PAlURvHZ6UkhGEPueod2VM7Op4jChg}
    # Токен для реальной торговли (продакшн)
    production-token: ${TINKOFF_PRODUCTION_TOKEN:t.0CTznpaRfqz_r6xbq0XY_sDcgYQVVMJ9ZAsEy4_i91P8IL2QIN5Jf0E8XDbx0gJcjpnNxXcuKuYWHxSEsl2zMw}
    # Режим по умолчанию (ВАЖНО: измените на sandbox для тестирования!)
    default-mode: sandbox  # sandbox или production

# Application Configuration
app:
  name: Tinkoff Trading Bot
  version: 1.0.0
  security:
    username: perminand
    password: Ftoren8686

# Dynamic Instruments Configuration
dynamic-instruments:
  cache:
    ttl-minutes: 5      # Время жизни кэша в минутах
    max-shares: 100     # Максимум акций (было 30)
    max-bonds: 50       # Максимум облигаций (было 15)  
    max-etfs: 30        # Максимум ETF (было 10)
    max-currencies: 10  # Максимум валют

# Margin Trading Configuration
margin-trading:
  allow-negative-cash: true    # Разрешить покупки при отрицательных средствах (используя плечо)
  min-buying-power-ratio: 0.1  # Минимальное отношение покупательной способности к стоимости покупки

# Position Management & Diversification
position-management:
  max-position-size-pct: 0.05      # Максимальный размер позиции: 5% от портфеля (было 20%)
  max-sector-exposure-pct: 0.15    # Максимальная доля одной отрасли: 15%
  max-positions-per-sector: 3      # Максимум позиций в одной отрасли
  max-total-positions: 15          # Максимум открытых позиций
  position-sizing:
    first-buy-pct: 0.005           # Первая покупка: 0.5% от buyingPower (было 2%)
    add-buy-pct: 0.003             # Докупка: 0.3% от buyingPower (было 1%)
    min-position-value: 1000       # Минимальная стоимость позиции в рублях

# Capital Management - КОНСЕРВАТИВНЫЕ НАСТРОЙКИ ДЛЯ БЕЗОПАСНОСТИ
capital-management:
  first-buy-pct: 0.005           # 0.5% от покупательной способности (УМЕНЬШЕНО)
  add-buy-pct: 0.003             # 0.3% при докупке (УМЕНЬШЕНО)
  min-position-value: 5000       # Минимальная стоимость позиции, RUB (было 1000)
  max-position-size-pct: 0.08    # Максимум на инструмент от портфеля (было 0.05)
  risk-per-trade-pct: 0.01       # Риск на сделку 1% от портфеля (было 0.005)
  enable-atr-cap: true           # Включить ATR-кап размера позиции

# Smart Analysis Configuration
smart-analysis:
  quick-monitoring:
    existing-positions: all    # Все существующие позиции
    priority-instruments: 5    # 5 приоритетных
    rotation-instruments: 5    # 5 из ротации
    total-per-cycle: 10-15     # Итого за 30 сек
  
  full-monitoring:
    existing-positions: all    # Все существующие позиции  
    priority-instruments: 15   # 15 приоритетных
    rotation-instruments: 15   # 15 из ротации
    total-per-cycle: 30-40     # Итого за 2 мин
  
  rotation:
    batch-size: 20            # Размер группы ротации
    full-cycle-days: 1        # Полный цикл за 1 день

# Logging Configuration
logging:
  level:
    ru.perminov: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE 
server:
  port: 8081

# Trading Cooldown Configuration - ЗАЩИТА ОТ OVERTRADING
cooldown:
  min:
    minutes: 45      # Минимальный cooldown между сделками (УВЕЛИЧЕНО)
  same:
    minutes: 60      # Cooldown для повторных операций (УВЕЛИЧЕНО)
  reverse:
    minutes: 90      # Cooldown для обратных операций (BUY->SELL) (УВЕЛИЧЕНО)
  protection:
    enabled: true    # Включить защиту от частых сделок
    window-seconds: 600  # Окно защиты в секундах (10 минут)

tbank:
  api:
    base-url: https://api.tbank.ru/invest
  